<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <script>
        // Verifica se a URL tem o código de recuperação (type=recovery)
        if (window.location.hash.includes('type=recovery') || window.location.search.includes('type=recovery')) {
            console.log("⚡ Recuperação detectada! Iniciando transporte...");
            
            // 1. Pega o "Hash" inteiro (tudo que vem depois de #, onde está o token)
            var tokenHash = window.location.hash;
            
            // 2. Se não tiver hash, tenta pegar os parâmetros de busca (?code=...)
            if (!tokenHash) tokenHash = window.location.search;

            // 3. Joga o usuário para a página nova-senha.html LEVANDO O TOKEN JUNTO
            // Sem o tokenHash, a página nova-senha não sabe quem é o usuário.
            window.location.href = 'nova-senha.html' + tokenHash;
        }
    </script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Estética Premium">
    <meta name="theme-color" content="#D4AF37">
    
    <title>Estética Premium - Gestão Profissional</title>
    
    <!-- PWA Icons -->
    <link rel="apple-touch-icon" href="icons/icon-180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192.png">
    <link rel="manifest" href="manifest.json">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;500;600;700&family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <!-- CSS -->
    <link rel="stylesheet" href="css/style.css?v=4.0">
    
</head>
<body>
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loading-content">
            <i class="fas fa-spa loading-icon"></i>
            <h2>Estética Premium</h2>
            <div class="loading-spinner"></div>
        </div>
    </div>

    <!-- Sidebar Menu -->
    <nav id="sidebar" class="sidebar">
        <div class="sidebar-header">
            <i class="fas fa-spa"></i>
            <h2>Estética Premium</h2>
        </div>
        
        <ul class="sidebar-menu">
            <li class="menu-item active" data-page="dashboard">
                <i class="fas fa-home"></i>
                <span>Dashboard</span>
            </li>
            <li class="menu-item" data-page="clientes">
                <i class="fas fa-users"></i>
                <span>Clientes</span>
            </li>
            <li class="menu-item" data-page="agenda">
                <i class="fas fa-calendar-alt"></i>
                <span>Agenda</span>
            </li>
            <li class="menu-item" data-page="servicos">
                <i class="fas fa-concierge-bell"></i>
                <span>Serviços</span>
            </li>
            <li class="menu-item" data-page="estoque">
                <i class="fas fa-boxes"></i>
                <span>Estoque</span>
            </li>
            <li class="menu-item" data-page="relatorios">
                <i class="fas fa-chart-pie"></i>
                <span>Relatórios</span>
            </li>
            <li class="menu-item" data-page="perfil" onclick="carregarDadosPerfil()">
                <i class="fas fa-user-circle"></i>
                <span>Meu Perfil</span>
            </li>
        </ul>
        
        <div class="sidebar-footer">
            <button 
                onclick="fazerLogout(event)" 
                ontouchstart="fazerLogout(event)" 
                class="btn-logout" 
                style="width: 100%; background: transparent; border: 1px solid #444; color: #fff; padding: 12px; margin-top: 10px; cursor: pointer; border-radius: 6px; font-size: 16px;">
                <i class="fas fa-sign-out-alt"></i> Sair
            </button>
        </div>
    </nav>

    <!-- Main Content -->
    <main id="mainContent" class="main-content">
        <!-- Header -->
        <header class="app-header">
            <button id="menuToggle" class="menu-toggle">
                <i class="fas fa-bars"></i>
            </button>
            <h1 id="pageTitle">Dashboard</h1>
            <div class="header-actions">
                <div class="notifications-wrapper" style="position: relative;">
                    <button class="icon-btn" id="notificationsBtn" onclick="toggleNotifications()">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge" id="notifCount" style="display: none;">0</span>
                    </button>
                    
                    <div id="notificationsDropdown" class="notifications-dropdown">
                        <div class="notif-header">
                            <span>Alertas</span>
                            <button class="btn-link-gold" onclick="limparNotificacoes(event)">Limpar</button>
                        </div>
                        <div id="notifList" class="notif-list">
                            <div class="notif-empty">Tudo tranquilo por aqui! ✨</div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Page Container -->
        <div id="pageContainer" class="page-container">
    
            <div id="dashboardPage" class="page active">
    
                <div class="metrics-row">
                    
                    <div class="metric-card">
                        <div class="metric-icon gold">
                            <i class="far fa-calendar-check"></i>
                        </div>
                        <div class="metric-info">
                            <h3 id="statAgendamentosHoje">0</h3>
                            <p>AGENDAMENTOS HOJE</p>
                        </div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-icon green">
                            <i class="fas fa-dollar-sign"></i>
                        </div>
                        <div class="metric-info">
                            <h3 id="statFaturamentoHoje">R$ 0,00</h3>
                            <p>FATURAMENTO HOJE</p>
                        </div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-icon blue">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="metric-info">
                            <h3 id="statTotalClientes">0</h3>
                            <p>TOTAL DE CLIENTES</p>
                        </div>
                    </div>

                    <div class="metric-card" style="border-left: 4px solid var(--error);">
                        <div class="metric-icon red">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="metric-info">
                            <h3 id="statDebitosTotal" style="color: var(--error);">R$ 0,00</h3>
                            <p>A RECEBER (GERAL)</p>
                        </div>
                    </div>

                </div>

                <div class="dashboard-grid">
                    <div class="dashboard-card full-width">
                        <div class="card-header">
                            <h3><i class="far fa-clock" style="color: var(--gold);"></i> Próximos Agendamentos</h3>
                            <button class="btn-link-gold" onclick="navigateTo('agenda')">Ver Agenda</button>
                        </div>
                        <div id="dashAgendamentosList" class="dashboard-list">
                            <div style="padding: 20px; text-align: center; color: #666;">Carregando...</div>
                        </div>
                    </div>

                    <div class="dashboard-row-split">
                        <div class="dashboard-card">
                            <div class="card-header">
                                <h3><i class="fas fa-boxes" style="color: var(--warning);"></i> Alertas de Estoque</h3>
                            </div>
                            <div id="dashEstoqueList" class="dashboard-list"></div>
                        </div>
                        <div class="dashboard-card">
                            <div class="card-header">
                                <h3><i class="fas fa-file-invoice-dollar" style="color: var(--error);"></i> Contas a Receber</h3>
                            </div>
                            <div id="dashContasReceberList" class="dashboard-list"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="clientesPage" class="page">
                <div class="header-controls">
                    <div class="search-bar">
                        <i class="fas fa-search"></i>
                        <input type="text" id="searchClientes" placeholder="Buscar clientes...">
                    </div>
                    <button class="btn-primary" onclick="abrirModalCliente()">
                        <i class="fas fa-plus"></i> Novo Cliente
                    </button>
                </div>
                <div id="clientesGrid" class="clientes-grid"></div>
            </div>

            <div id="agendaPage" class="page">
                <div class="page-header-custom">
                    <button onclick="abrirModalHorarios()" class="btn-secondary" style="border: 1px solid #444;">
                        <i class="fas fa-cog"></i> Horários
                    </button>
                    <h2 style="color: var(--gold); margin: 0;"><i class="far fa-calendar-alt"></i> Agenda</h2>
                    
                    <div style="display: flex; gap: 10px;">
                        <button onclick="copiarLinkAgendamento()" class="btn-share-link">
                            <i class="fas fa-share-alt"></i> Link para Cliente
                        </button>

                        <button id="btnConnectGoogle" onclick="conectarGoogle()" class="btn-google-sync">
                            <i class="fab fa-google"></i> Sincronizar
                        </button>
                    </div>
                </div>

                <div class="modern-calendar-wrapper">
                    <div class="calendar-header">
                        <button class="cal-btn" onclick="mudarMes(-1)">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        
                        <h3 id="calendarMonthYear">CARREGANDO...</h3>
                        
                        <button class="cal-btn" onclick="mudarMes(1)">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                    
                    <div class="calendar-weekdays">
                        <div>Dom</div><div>Seg</div><div>Ter</div><div>Qua</div><div>Qui</div><div>Sex</div><div>Sáb</div>
                    </div>
                    
                    <div id="calendarGrid" class="calendar-grid"></div>
                    
                    <div class="calendar-footer">
                        <button class="btn-today-modern" onclick="hoje()">Ir para Hoje</button>
                    </div>
                </div>

                <div class="agenda-quick-actions" style="display: flex; justify-content: space-between; align-items: center; margin: 20px 0; padding: 0 5px;">
                    <div style="font-size: 1.1rem;">
                        <span style="color: #888;">Data selecionada:</span>
                        <strong id="dataSelecionadaTexto" style="color: var(--gold); margin-left: 5px;">-</strong>
                    </div>
                    <button class="btn-primary" onclick="abrirModalAgendamento()">
                        <i class="fas fa-plus"></i> Novo Agendamento
                    </button>
                </div>

                <div id="agendaContainer" class="agenda-timeline"></div>
            </div>

            <div id="servicosPage" class="page">
                <div class="header-controls">
                    <div class="search-bar">
                        <i class="fas fa-search"></i>
                        <input type="text" id="searchServicos" placeholder="Buscar serviços...">
                    </div>
                    <button class="btn-primary" onclick="abrirModalServico()">
                        <i class="fas fa-plus"></i> Novo Serviço
                    </button>
                </div>
                <div id="servicosGrid" class="servicos-grid"></div>
            </div>

            <div id="estoquePage" class="page">
                <div class="header-controls">
                    <div class="search-bar">
                        <i class="fas fa-search"></i>
                        <input type="text" id="searchEstoque" placeholder="Buscar produtos...">
                    </div>
                    <button class="btn-primary" onclick="abrirModalEstoque()">
                        <i class="fas fa-plus"></i> Novo Produto
                    </button>
                </div>
                <div id="estoqueGrid" class="estoque-grid"></div>
            </div>

            <div id="relatoriosPage" class="page">
                <div class="page-header">
                    <div class="relatorio-date-picker">
                        <label>Período:</label>
                        <select id="relatorioMes" onchange="carregarRelatorios()">
                            <option value="0">Janeiro</option>
                            <option value="1">Fevereiro</option>
                            <option value="2">Março</option>
                            <option value="3">Abril</option>
                            <option value="4">Maio</option>
                            <option value="5">Junho</option>
                            <option value="6">Julho</option>
                            <option value="7">Agosto</option>
                            <option value="8">Setembro</option>
                            <option value="9">Outubro</option>
                            <option value="10">Novembro</option>
                            <option value="11">Dezembro</option>
                        </select>
                        <input type="number" id="relatorioAno" value="2026" onchange="carregarRelatorios()">
                    </div>
                    <button class="btn-primary" onclick="window.print()">
                        <i class="fas fa-file-pdf"></i> Imprimir
                    </button>
                </div>
                <div id="relatoriosContent" class="relatorios-grid">
                    </div>
            </div>
            <div id="perfilPage" class="page">
                <div class="page-header-custom">
                    <h2 style="color: var(--gold); margin: 0;"><i class="fas fa-user-cog"></i> Meu Perfil</h2>
                </div>

                <div class="profile-container-premium">
                    <div class="profile-header-card">
                        <div class="profile-avatar-wrapper">
                            <img id="avatarPreview" src="" alt="Foto de Perfil" style="display: none;">
                            
                            <div id="avatarDefaultIcon" class="avatar-default">
                                <i class="fas fa-user"></i>
                            </div>

                            <label for="inputFotoPerfil" class="avatar-overlay">
                                <i class="fas fa-camera"></i>
                                <span>Alterar</span>
                            </label>
                            
                            <input type="file" id="inputFotoPerfil" accept="image/*" onchange="uploadFotoPerfil(event)">
                        </div>
                        <div class="profile-title">
                            <h3 id="displayNome">Doutora</h3>
                            <span id="displayEmail">Carregando email...</span>
                        </div>
                    </div>

                    <form id="formPerfilInterno">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Nome Completo (Visível para o cliente)</label>
                                <input type="text" id="profNome" placeholder="Ex: Dra. Ana Silva">
                            </div>
                            <div class="form-group">
                                <label>Especialidade</label>
                                <input type="text" id="profEspecialidade" placeholder="Ex: Biomédica Esteta">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>Telefone / WhatsApp Profissional</label>
                                <input type="text" id="profTelefone" placeholder="(00) 00000-0000">
                            </div>
                            <div class="form-group">
                                <label>Link de Agendamento Personalizado</label>
                                <div style="display: flex; gap: 10px;">
                                    <input type="text" id="profLink" readonly style="background: #222; color: #888; font-size: 12px;">
                                    <button type="button" class="btn-secondary" onclick="copiarLinkPerfil()" style="width: auto; padding: 0 15px;">
                                        <i class="fas fa-copy"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="form-actions" style="margin-top: 30px; border-top: 1px solid #333; padding-top: 20px;">
                            <button type="submit" class="btn-primary" style="width: 100%; padding: 15px; font-size: 1.1rem;">
                                Salvar Alterações
                            </button>
                        </div>
                    </form>
                </div>
            </div>

        </div>

        <div id="modalAgendamento" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="modalAgendamentoTitle">Novo Agendamento</h2>
                    <button class="modal-close" onclick="fecharModal('modalAgendamento')">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form id="formAgendamento" class="modal-form">
                    <input type="hidden" id="agendamentoId">
                    
                    <label style="margin-bottom: 10px; display: block;">O QUE VOCÊ VAI AGENDAR?</label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="tipoAgendamento" value="servico" checked onclick="toggleTipoAgendamento()">
                            <span><i class="fas fa-cut"></i> Serviço</span>
                        </label>

                        <label class="radio-label">
                            <input type="radio" name="tipoAgendamento" value="evento" onclick="toggleTipoAgendamento()">
                            <span><i class="fas fa-calendar-star"></i> Evento Pessoal</span>
                        </label>
                    </div>
                    
                    <div id="camposServico">
                        <div class="form-group">
                            <label>Cliente *</label>
                            <select id="agendamentoCliente" onchange="selectCliente()"></select>
                        </div>
                        
                        <div class="form-group">
                            <label>Serviço *</label>
                            <select id="agendamentoServico" onchange="selectServico()"></select>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Valor (R$)</label>
                                <input type="text" id="agendamentoValor" readonly style="background: #222; color: var(--gold); font-weight: bold;">
                            </div>
                            <div class="form-group">
                                <label>Status Pagamento</label>
                                <select id="agendamentoStatusPagamento">
                                    <option value="pendente">Pendente</option>
                                    <option value="pago">Pago</option>
                                    <option value="devendo">Devendo</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div id="camposEvento" style="display: none;">
                        <div class="form-group">
                            <label>Nome do Evento *</label>
                            <input type="text" id="eventoNome" placeholder="Ex: Almoço, Reunião...">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Data *</label>
                            <input type="date" id="agendamentoData" required>
                        </div>
                        <div class="form-group">
                            <label>Hora *</label>
                            <input type="time" id="agendamentoHora" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Observações</label>
                        <textarea id="agendamentoObservacoes" rows="2"></textarea>
                    </div>
                    
                    <div class="modal-buttons" style="justify-content: space-between; align-items: center; display: flex; width: 100%;">
    
                        <button type="button" id="btnExcluirAgendaModal" class="btn-danger" style="display: none;" onclick="excluirDoModal()">
                            <i class="fas fa-trash"></i> Excluir
                        </button>

                        <div style="display: flex; gap: 10px; margin-left: auto;">
                            <button type="button" class="btn-secondary" onclick="fecharModal('modalAgendamento')">Cancelar</button>
                            <button type="submit" class="btn-primary">Salvar</button>
                        </div>

                    </div>
                </form>
            </div>
        </div>
    </main>

    <!-- Modals -->
    <!-- Modal Cliente -->
    <div id="modalCliente" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalClienteTitle">Novo Cliente</h2>
                <button class="modal-close" onclick="fecharModal('modalCliente')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="formCliente">
                <input type="hidden" id="clienteId">
                
                <div style="margin-bottom: 15px;">
                    <label>Nome Completo</label>
                    <input type="text" id="clienteNome" required placeholder="Ex: Maria Silva">
                </div>

                <div class="form-grid">
                    <div>
                        <label>Telefone</label>
                        <input type="tel" id="clienteTelefone" required placeholder="(11) 99999-9999">
                    </div>
                    <div>
                        <label>Data de Nascimento</label>
                        <input type="date" id="clienteNascimento">
                    </div>
                </div>

                <div class="form-grid">
                    <div>
                        <label>CPF</label>
                        <input type="text" id="clienteCpf" placeholder="000.000.000-00">
                    </div>
                    <div>
                        <label>Email</label>
                        <input type="email" id="clienteEmail" placeholder="email@exemplo.com">
                    </div>
                </div>

                <div style="margin: 20px 0; display: flex; align-items: center; gap: 10px;">
                    <hr style="flex: 1;">
                    <span style="font-size: 0.8rem; text-transform: uppercase; letter-spacing: 1px; color: var(--gold);">Endereço</span>
                    <hr style="flex: 1;">
                </div>

                <div class="grid-cep">
                    <div>
                        <label>CEP</label>
                        <input type="text" id="clienteCep" placeholder="00000-000" onblur="buscarCep()" maxlength="9">
                    </div>
                    <div>
                        <label>Rua / Logradouro</label>
                        <input type="text" id="clienteEndereco">
                    </div>
                </div>

                <div class="grid-numero">
                    <div>
                        <label>Número</label>
                        <input type="text" id="clienteNumero">
                    </div>
                    <div>
                        <label>Bairro</label>
                        <input type="text" id="clienteBairro">
                    </div>
                </div>

                <div class="grid-cidade">
                    <div>
                        <label>Cidade</label>
                        <input type="text" id="clienteCidade">
                    </div>
                    <div>
                        <label>UF</label>
                        <input type="text" id="clienteEstado" maxlength="2" style="text-transform: uppercase;">
                    </div>
                </div>

                <div class="modal-buttons">
                    <button type="button" class="btn-secondary" onclick="fecharModal('modalCliente')">Cancelar</button>
                    <button type="submit" class="btn-primary">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <div id="modalDetalhesCliente" class="modal">
        <div class="modal-content">
            
            <div class="modal-header" style="border:none; padding-bottom: 0;">
                <div style="display: flex; align-items: center; gap: 15px;">
                    <div class="cliente-avatar-large" id="detalhesAvatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div>
                        <h2 id="detalhesClienteNome" style="margin: 0; font-size: 1.8rem;">Nome do Cliente</h2>
                        <span class="status-badge" style="background: var(--bg-input); color: var(--text-secondary); margin-top: 5px; display: inline-block;">Cliente Cadastrado</span>
                    </div>
                </div>
                <div class="modal-footer-actions">
                    <button onclick="abrirAnamnese()" class="btn-action" style="border: 1px solid var(--gold); color: var(--gold); background: transparent;">
                        <i class="fas fa-file-medical"></i> Ficha Anamnese
                    </button>
                </div>
                <button class="modal-close" onclick="fecharModal('modalDetalhesCliente')">&times;</button>
            </div>

            <div class="modal-body" style="padding-top: 20px;">
                
                <div class="info-grid-row">
                    <div class="info-box">
                        <label>Telefone (WhatsApp)</label>
                        <span id="detalhesClienteTelefone">...</span>
                    </div>
                    <div class="info-box">
                        <label>E-mail</label>
                        <span id="detalhesClienteEmail">...</span>
                    </div>
                </div>
                
                <div class="info-box full-width" id="boxEndereco" style="margin-top: 15px;">
                    <label>Endereço</label>
                    <span id="detalhesClienteEndereco">...</span>
                </div>

                <hr>

                <div class="client-stats-row">
                    <div class="stat-box">
                        <small>Total de Serviços</small>
                        <strong id="detalhesTotalServicos">0</strong>
                    </div>
                    <div class="stat-box">
                        <small>Valor Gasto</small>
                        <strong id="detalhesValorTotal" style="color: var(--success);">R$ 0,00</strong>
                    </div>
                    <div class="stat-box">
                        <small>Débitos Pendentes</small>
                        <strong id="detalhesDebitos" style="color: var(--error);">R$ 0,00</strong>
                    </div>
                </div>

                <div class="detalhes-tabs" style="margin-top: 20px;">
                    <button class="tab-btn active" onclick="trocarTab('historico')">Histórico</button>
                    <button class="tab-btn" onclick="trocarTab('agendados')">Agendados</button>
                </div>

                <div id="tabHistorico" class="tab-content active">
                    <div id="detalhesHistorico" class="scroll-list"></div>
                </div>
                <div id="tabAgendados" class="tab-content">
                    <div id="detalhesAgendados" class="scroll-list"></div>
                </div>

                <div class="modal-footer-actions">
                    <button onclick="editarCliente()" class="btn-action edit">
                        <i class="fas fa-edit"></i> Editar Dados
                    </button>
                    <button onclick="deletarClienteAtual()" class="btn-action delete">
                        <i class="fas fa-trash"></i> Excluir Cliente
                    </button>
                </div>

            </div>
        </div>
    </div>

    <div id="modalAnamnese" class="modal">
        <div class="modal-content anamnese-paper">
            <div class="modal-header no-print">
                <h2>Ficha de Anamnese</h2>
                <button class="modal-close" onclick="fecharModal('modalAnamnese')">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="anamnese-header-print only-print">
                <h1>Estética Premium</h1>
                <p>Ficha de Avaliação e Anamnese</p>
            </div>

            <div class="anamnese-tabs no-print">
                <button type="button" class="tab-btn active" onclick="trocarTabAnamnese('texto')">
                    <i class="fas fa-list-alt"></i> Perguntas
                </button>
                <button type="button" class="tab-btn" onclick="trocarTabAnamnese('desenho')">
                    <i class="fas fa-pen-fancy"></i> Mapa Facial / Desenho
                </button>
            </div>

            <form id="formAnamnese">
                
                <div id="tabAnamneseTexto" class="anamnese-tab-content active">
                    <div class="anamnese-section">
                        <h3>1. Histórico de Saúde</h3>
                        <div class="checkbox-group">
                            <label><input type="checkbox" name="saude_gestante"> Gestante / Lactante</label>
                            <label><input type="checkbox" name="saude_cardiaco"> Problemas Cardíacos</label>
                            <label><input type="checkbox" name="saude_diabetes"> Diabetes</label>
                            <label><input type="checkbox" name="saude_alergia"> Alergias</label>
                            <label><input type="checkbox" name="saude_oncologico"> Histórico Oncológico</label>
                        </div>
                        <div class="form-group">
                            <label>Uso de Medicamentos Contínuos?</label>
                            <input type="text" name="medicamentos" placeholder="Quais?">
                        </div>
                        <div class="form-group">
                            <label>Alergias Específicas?</label>
                            <input type="text" name="alergias_obs" placeholder="Medicamentos, cosméticos, alimentos...">
                        </div>
                    </div>

                    <div class="anamnese-section">
                        <h3>2. Histórico Estético</h3>
                        <div class="form-group">
                            <label>Queixa Principal</label>
                            <textarea name="queixa_principal" rows="2"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Cuidados Diários (Home Care)</label>
                            <input type="text" name="home_care">
                        </div>
                    </div>
                </div>

                <div id="tabAnamneseDesenho" class="anamnese-tab-content">
                    <div class="drawing-toolbar no-print">
                        <label>Cor da Caneta:</label>
                        <div class="color-picker">
                            <div class="color-dot active" style="background: #000;" onclick="setCorCaneta('#000000', this)"></div> <div class="color-dot" style="background: #E53935;" onclick="setCorCaneta('#E53935', this)"></div> <div class="color-dot" style="background: #1E88E5;" onclick="setCorCaneta('#1E88E5', this)"></div> <div class="color-dot" style="background: #43A047;" onclick="setCorCaneta('#43A047', this)"></div> </div>
                        <button type="button" class="btn-small" onclick="limparMapaFacial()">
                            <i class="fas fa-eraser"></i> Limpar
                        </button>
                    </div>

                    <div class="mapa-container">
                        <canvas id="mapaFacialCanvas" width="600" height="500"></canvas>
                        
                        <div class="mapa-background">
                            <svg viewBox="0 0 200 250" xmlns="http://www.w3.org/2000/svg" stroke="#ccc" fill="none" stroke-width="1">
                                <path d="M50,60 C50,10 150,10 150,60 C150,130 130,160 100,170 C70,160 50,130 50,60 Z" />
                                <path d="M70,75 Q80,65 90,75" />
                                <path d="M110,75 Q120,65 130,75" />
                                <path d="M100,80 L95,110 L105,110" />
                                <path d="M85,130 Q100,140 115,130" />
                                <path d="M70,155 L70,200" />
                                <path d="M130,155 L130,200" />
                            </svg>
                        </div>
                    </div>
                    <p style="text-align: center; color: #888; font-size: 0.8rem;">Use a caneta do tablet para marcar áreas de interesse.</p>
                </div>

                <div class="anamnese-section">
                    <h3>3. Termo e Assinatura</h3>
                    <p class="legal-text">
                        Declaro que as informações são verdadeiras.
                    </p>
                    
                    <div class="signature-area">
                        <label>Assinatura da Cliente:</label>
                        
                        <div class="canvas-wrapper">
                            <canvas id="signatureCanvas"></canvas>
                        </div>
                        
                        <div class="signature-actions no-print">
                            <button type="button" class="btn-link-gold" onclick="limparAssinatura()">Limpar Assinatura</button>
                        </div>
                    </div>
                </div>

                <div class="modal-buttons no-print">
                    <button type="button" class="btn-secondary" onclick="buscarEImprimirFicha()">
                        <i class="fas fa-print"></i> Imprimir Ficha Salva
                    </button>
                    
                    <button type="submit" class="btn-primary">Salvar Ficha</button>
                </div>
            </form>
        </div>
    </div>

    <div id="fichaImpressao" class="print-only-container">
        <div class="print-header">
            <h1>Estética Premium</h1>
            <p>Ficha de Avaliação e Anamnese</p>
            <div class="print-meta">
                <span><strong>Cliente:</strong> <span id="printNomeCliente"></span></span>
                <span><strong>Data:</strong> <span id="printDataFicha"></span></span>
            </div>
        </div>

        <div class="print-body">
            <div class="print-section">
                <h3>1. Histórico de Saúde</h3>
                <div class="print-grid">
                    <div><span id="checkGestante">☐</span> Gestante/Lactante</div>
                    <div><span id="checkCardiaco">☐</span> Cardíaco</div>
                    <div><span id="checkDiabetes">☐</span> Diabetes</div>
                    <div><span id="checkAlergia">☐</span> Alergias</div>
                    <div><span id="checkOnco">☐</span> Histórico Oncológico</div>
                </div>
                <p><strong>Medicamentos:</strong> <span id="printMedicamentos"></span></p>
                <p><strong>Alergias/Obs:</strong> <span id="printAlergias"></span></p>
            </div>

            <div class="print-section">
                <h3>2. Histórico Estético</h3>
                <p><strong>Queixa Principal:</strong> <br> <span id="printQueixa"></span></p>
                <p><strong>Home Care:</strong> <span id="printHomeCare"></span></p>
            </div>

            <div class="print-section keep-together">
                <h3>3. Mapeamento Facial</h3>
                <div class="print-map-container">
                    <img id="printMapaImg" src="" alt="Mapa Facial" style="max-height: 300px; max-width: 100%; display: block; margin: 0 auto;">
                </div>
            </div>

            <div class="print-section keep-together">
                <h3>4. Termo de Responsabilidade</h3>
                <p class="legal-text-small">
                    Declaro que as informações acima são verdadeiras e autorizo a realização dos procedimentos.
                </p>
                <div class="print-sig-container" style="text-align: center; margin-top: 30px;">
                    <img id="printAssinaturaImg" src="" alt="Assinatura" style="height: 80px; display: block; margin: 0 auto;">
                    <div class="line" style="border-top: 1px solid #000; display: inline-block; width: 300px; margin-top: 5px;"></div>
                    <div class="label">Assinatura do Cliente</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Agendamento -->
    <div id="modalAgendamento" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Novo Agendamento</h2>
                <button class="modal-close" onclick="fecharModal('modalAgendamento')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="formAgendamento" class="modal-form">
                <input type="hidden" id="agendamentoId">
                
                <div class="form-group">
                    <label>TIPO DE AGENDAMENTO *</label>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="tipoAgendamento" value="servico" checked onclick="toggleTipoAgendamento()">
                                <span>Serviço</span>
                            </label>

                            <label class="radio-label">
                                <input type="radio" name="tipoAgendamento" value="evento" onclick="toggleTipoAgendamento()">
                                <span>Evento Pessoal</span>
                            </label>
                        </div>
                </div>
                
                <div id="camposServico">
                    <div class="form-group">
                        <label for="agendamentoCliente">Cliente *</label>
                        <select id="agendamentoCliente" onchange="selectCliente()"></select>
                    </div>
                    
                    <div class="form-group">
                        <label for="agendamentoServico">Serviço *</label>
                        <select id="agendamentoServico" onchange="selectServico()"></select>
                    </div>
                    
                    <div class="form-group">
                        <label for="agendamentoValor">Valor *</label>
                        <input type="text" id="agendamentoValor" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label for="agendamentoStatusPagamento">Status Pagamento *</label>
                        <select id="agendamentoStatusPagamento">
                            <option value="pendente">Pendente</option>
                            <option value="pago">Pago</option>
                            <option value="devendo">Devendo</option>
                        </select>
                    </div>
                </div>
                
                <div id="camposEvento" style="display: none;">
                    <div class="form-group">
                        <label for="eventoNome">Nome do Evento *</label>
                        <input type="text" id="eventoNome" placeholder="Ex: Palestra de Técnicas Avançadas">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="agendamentoData">Data *</label>
                        <input type="date" id="agendamentoData" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="agendamentoHora">Hora *</label>
                        <input type="time" id="agendamentoHora" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="agendamentoObservacoes">Observações</label>
                    <textarea id="agendamentoObservacoes" rows="3"></textarea>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="fecharModal('modalAgendamento')">Cancelar</button>
                    <button type="submit" class="btn-primary">Agendar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Serviço -->
    <div id="modalServico" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalServicoTitle">Novo Serviço</h2>
                <button class="modal-close" onclick="fecharModal('modalServico')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="formServico" class="modal-form">
                <input type="hidden" id="servicoId">
                
                <div class="form-group">
                    <label for="servicoNome">Nome do Serviço *</label>
                    <input type="text" id="servicoNome" required placeholder="Ex: Preenchimento Labial">
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="servicoTipo">Tipo/Categoria *</label>
                        <input type="text" id="servicoTipo" required placeholder="Ex: Harmonização Facial">
                    </div>
                    
                    <div class="form-group">
                        <label for="servicoDuracao">Duração (minutos) *</label>
                        <input type="number" id="servicoDuracao" required min="15" step="15" placeholder="60">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="servicoValor">Valor *</label>
                    <input type="number" id="servicoValor" required min="0" step="0.01" placeholder="0.00">
                </div>
                
                <div class="form-group">
                    <label for="servicoDescricao">Descrição</label>
                    <textarea id="servicoDescricao" rows="3" placeholder="Descrição detalhada do serviço..."></textarea>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="fecharModal('modalServico')">Cancelar</button>
                    <button type="submit" class="btn-primary">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Estoque -->
    <div id="modalEstoque" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalEstoqueTitle">Novo Produto</h2>
                <button class="modal-close" onclick="fecharModal('modalEstoque')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="formEstoque" class="modal-form">
                <input type="hidden" id="estoqueId">
                
                <div class="form-group">
                    <label for="estoqueNome">Nome do Produto *</label>
                    <input type="text" id="estoqueNome" required placeholder="Ex: Botox 100U">
                </div>
                
                <div class="form-group">
                    <label for="estoqueDescricao">Descrição</label>
                    <textarea id="estoqueDescricao" rows="2" placeholder="Descrição do produto..."></textarea>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="estoqueValor">Valor Unitário *</label>
                        <input type="number" id="estoqueValor" required min="0" step="0.01" placeholder="0.00">
                    </div>
                    
                    <div class="form-group">
                        <label for="estoqueQuantidade">Quantidade *</label>
                        <input type="number" id="estoqueQuantidade" required min="0" placeholder="0">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="estoqueQuantidadeMinima">Quantidade Mínima *</label>
                    <input type="number" id="estoqueQuantidadeMinima" required min="1" placeholder="5">
                    <small>Você será alertado quando o estoque estiver abaixo deste valor</small>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="fecharModal('modalEstoque')">Cancelar</button>
                    <button type="submit" class="btn-primary">Salvar</button>
                </div>
            </form>
        </div>
    </div>
    <div id="modalHorarios" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2>Configurar Horários de Atendimento</h2>
                <button class="modal-close" onclick="fecharModal('modalHorarios')">&times;</button>
            </div>
            <div class="modal-body">
                <p style="color: #888; font-size: 0.9rem; margin-bottom: 15px;">Defina os horários que aparecerão para os clientes.</p>
                <form id="formHorarios">
                    <div id="listaDiasSemana">
                        <div style="text-align: center; padding: 20px;">Carregando...</div>
                    </div>
                    <div class="modal-buttons">
                        <button type="button" class="btn-secondary" onclick="fecharModal('modalHorarios')">Cancelar</button>
                        <button type="submit" class="btn-primary">Salvar Configuração</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Overlay -->
    <div id="overlay" class="overlay"></div>

    <!-- Toast Notifications -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <div id="toastContainer" class="toast-container"></div>
    
    <script src="js/supabase-client.js?v=4.0"></script> 
    <script src="js/app.js?v=4.0"></script>
    <script src="js/app-agenda.js?v=4.0"></script>
    <script src="js/app-relatorios.js?v=4.0"></script>
    <script src="js/popular-dados.js?v=4.0"></script>
    <script src="js/app-anamnese.js?v=4.0"></script>
</body>
</body>
</body>
</html>
